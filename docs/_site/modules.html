<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="A front-end template that helps you build fast, modern mobile web apps.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>Modules</title>

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="images/android-desktop.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Material Design Lite">
    <link rel="apple-touch-icon-precomposed" href="images/ios-desktop.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#3372DF">

    <link rel="shortcut icon" href="images/favicon.png">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="/multibot/assets/css/custom.css">
    <style>
    </style>
  </head>
  <body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <!-- Title -->
          <span class="mdl-layout-title">Modules</span>
          <!-- Add spacer, to align navigation to the right -->
          <div class="mdl-layout-spacer"></div>
          <!-- Navigation -->
          <nav class="mdl-navigation mdl-layout--large-screen-only">
            <a class="mdl-navigation__link" href="/multibot/">Accueil</a>
            <a class="mdl-navigation__link" href="/multibot/architecture.html">Architecture</a>
            <a class="mdl-navigation__link" href="/multibot/commands.html">Commandes</a>
            <a class="mdl-navigation__link" href="/multibot/commands-list.html">Liste des commandes</a>
            <a class="mdl-navigation__link" href="/multibot/configuration.html">Configuration</a>
            <a class="mdl-navigation__link" href="/multibot/events.html">Événements</a>
            <a class="mdl-navigation__link" href="/multibot/modules.html">Modules</a>
            <a class="mdl-navigation__link" href="/multibot/modules-list.html">Liste des modules</a>
            <a class="mdl-navigation__link" href="/multibot/sitemap.html">Plan du site</a>
          </nav>
        </div>
      </header>
      <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">Navigation</span>
        <nav class="mdl-navigation">
          <a class="mdl-navigation__link" href="/multibot/">Accueil</a>
          <a class="mdl-navigation__link" href="/multibot/architecture.html">Architecture</a>
          <a class="mdl-navigation__link" href="/multibot/commands.html">Commandes</a>
          <a class="mdl-navigation__link" href="/multibot/commands-list.html">Liste des commandes</a>
          <a class="mdl-navigation__link" href="/multibot/configuration.html">Configuration</a>
          <a class="mdl-navigation__link" href="/multibot/events.html">Événements</a>
          <a class="mdl-navigation__link" href="/multibot/modules.html">Modules</a>
          <a class="mdl-navigation__link" href="/multibot/modules-list.html">Liste des modules</a>
          <a class="mdl-navigation__link" href="/multibot/sitemap.html">Plan du site</a>
        </nav>
      </div>
      <main class="mdl-layout__content">
        <div class="page-content"><h1 id="le-système-de-modules">Le Système de Modules</h1>

<p>Le système de modules est une des caractéristiques les plus puissantes de ce framework. Il permet d’encapsuler des fonctionnalités complètes (commandes, événements, logique de fond) dans des unités autonomes qui peuvent être activées ou désactivées pour chaque bot individuellement.</p>

<h2 id="quest-ce-quun-module-">Qu’est-ce qu’un Module ?</h2>

<p>Un module est un dossier situé dans le répertoire <code class="language-plaintext highlighter-rouge">Modules/</code>. Ce dossier contient tout le code nécessaire à une fonctionnalité spécifique. Par exemple, un module <code class="language-plaintext highlighter-rouge">AutoRole</code> gère tout ce qui est lié à l’attribution automatique de rôles.</p>

<p>L’avantage principal est la <strong>séparation des préoccupations</strong>. Au lieu d’avoir des dizaines de commandes et d’événements mélangés, chaque fonctionnalité est isolée dans son propre module, ce qui rend le code plus facile à maintenir et à déboguer.</p>

<h2 id="structure-dun-module">Structure d’un Module</h2>

<p>Un module est un dossier à la racine de <code class="language-plaintext highlighter-rouge">Modules/</code>. Le nom du dossier sert d’identifiant pour le module (par exemple, <code class="language-plaintext highlighter-rouge">AutoRole</code>).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

## Liste des Modules

Voici la liste de tous les modules disponibles. Cliquez sur le nom d'un module pour voir sa documentation détaillée.

- [AutoRole](./modules_pages/AutoRole.md)
- [ChannelManager](./modules_pages/ChannelManager.md)
- [GetiJsonToDataBase](./modules_pages/GetiJsonToDataBase.md)
- [MatchNotifier](./modules_pages/MatchNotifier.md)
- [Secretary](./modules_pages/Secretary.md)
- [ShareChannel](./modules_pages/ShareChannel.md)
- [VocalDuplicate](./modules_pages/VocalDuplicate.md)
Modules/
└── AutoRole/
    ├── index.js           # Point d'entrée du module (obligatoire)
    ├── AutoRoleCommand.js # Fichier d'une commande spécifique au module
    ├── utils.js           # Fonctions utilitaires pour le module
    └── models/            # Modèles de données si nécessaire
        └── OlympeTeam.js
</code></pre></div></div>

<h3 id="le-fichier-indexjs">Le Fichier <code class="language-plaintext highlighter-rouge">index.js</code></h3>

<p>C’est le cœur du module. Ce fichier doit exporter une fonction qui prend l’instance du <code class="language-plaintext highlighter-rouge">bot</code> en paramètre.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Modules/MonModule/index.js</span>

<span class="c1">// Importez les commandes et événements spécifiques à votre module</span>
<span class="kd">const</span> <span class="nx">MyCommand</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./MyCommand.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">MyEvent</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./MyEvent.js</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bot</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 'bot' est l'instance du bot pour lequel ce module est chargé.</span>

    <span class="c1">// 1. Logique interne du module</span>
    <span class="c1">// Vous pouvez attacher des écouteurs d'événements ou démarrer des tâches de fond</span>
    <span class="c1">// qui ne sont pertinentes que pour ce module.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`[</span><span class="p">${</span><span class="nx">bot</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">] Module "MonModule" chargé.`</span><span class="p">);</span>
    <span class="nx">bot</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">ready</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Faire quelque chose quand le bot est prêt</span>
    <span class="p">});</span>

    <span class="nf">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Exécuter une tâche toutes les heures</span>
    <span class="p">},</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>


    <span class="c1">// 2. Enregistrement des commandes et événements</span>
    <span class="c1">// Retournez un objet contenant les classes de commandes et d'événements</span>
    <span class="c1">// que vous souhaitez rendre disponibles globalement.</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nx">MyCommand</span><span class="p">,</span> <span class="nx">MyEvent</span> <span class="p">};</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="comment-un-module-fonctionne-t-il-">Comment un Module Fonctionne-t-il ?</h2>

<ol>
  <li><strong>Chargement</strong> : Au démarrage, le <code class="language-plaintext highlighter-rouge">BotManager</code> parcourt la configuration de chaque <code class="language-plaintext highlighter-rouge">Bot</code>. Si un module est activé pour un bot, le <code class="language-plaintext highlighter-rouge">BotManager</code> charge le fichier <code class="language-plaintext highlighter-rouge">Modules/&lt;NomModule&gt;/index.js</code>.</li>
  <li><strong>Initialisation</strong> : Le <code class="language-plaintext highlighter-rouge">BotManager</code> exécute la fonction exportée par <code class="language-plaintext highlighter-rouge">index.js</code>, en lui passant l’instance du <code class="language-plaintext highlighter-rouge">bot</code> concerné.</li>
  <li><strong>Logique interne</strong> : Le code à l’intérieur de la fonction est exécuté. C’est là que le module peut démarrer ses propres timers (<code class="language-plaintext highlighter-rouge">setInterval</code>) ou attacher des écouteurs d’événements spécifiques (<code class="language-plaintext highlighter-rouge">bot.on(...)</code>).</li>
  <li><strong>Enregistrement</strong> : La fonction du module retourne un objet. Le <code class="language-plaintext highlighter-rouge">BotManager</code> parcourt cet objet et enregistre chaque <code class="language-plaintext highlighter-rouge">Command</code> auprès du <code class="language-plaintext highlighter-rouge">CommandManager</code> et chaque <code class="language-plaintext highlighter-rouge">Event</code> auprès de l’<code class="language-plaintext highlighter-rouge">EventManager</code>. Ces commandes et événements deviennent alors disponibles pour le bot, comme s’ils avaient été chargés depuis les dossiers <code class="language-plaintext highlighter-rouge">Commandes/</code> ou <code class="language-plaintext highlighter-rouge">Events/</code>.</li>
</ol>

<h2 id="configuration-des-modules">Configuration des Modules</h2>

<p>L’activation et la configuration d’un module se font dans la configuration de chaque bot (voir <code class="language-plaintext highlighter-rouge">doc/configuration.md</code>).</p>

<p>Dans l’objet de configuration d’un bot, la clé <code class="language-plaintext highlighter-rouge">modules</code> contient un objet où chaque clé est le nom d’un module (le nom du dossier) et la valeur est soit <code class="language-plaintext highlighter-rouge">true</code> (pour activer avec la configuration par défaut), soit un objet de configuration spécifique.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MonBotTest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"modules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"AutoRole"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"everyXhours"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
            </span><span class="nl">"roleIds"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"caster"</span><span class="p">:</span><span class="w"> </span><span class="s2">"987654321"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"ChannelManager"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"UnAutreModule"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Ce</span><span class="w"> </span><span class="err">module</span><span class="w"> </span><span class="err">ne</span><span class="w"> </span><span class="err">sera</span><span class="w"> </span><span class="err">pas</span><span class="w"> </span><span class="err">chargé</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Dans le code de votre module (<code class="language-plaintext highlighter-rouge">index.js</code>), vous pouvez accéder à cette configuration via <code class="language-plaintext highlighter-rouge">bot.modules.&lt;NomModule&gt;</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Modules/AutoRole/index.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bot</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">bot</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">AutoRole</span><span class="p">;</span> <span class="c1">// Récupère la configuration du module</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">config</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// Sécurité : ne rien faire si le module n'est pas configuré</span>

    <span class="kd">const</span> <span class="nx">intervalHours</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">everyXhours</span> <span class="o">||</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// Utilise la valeur de la config ou une valeur par défaut</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Le module AutoRole s'exécutera toutes les </span><span class="p">${</span><span class="nx">intervalHours</span><span class="p">}</span><span class="s2"> heures.`</span><span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>
</div>
      </main>
    </div>
    <script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  </body>
</html>
